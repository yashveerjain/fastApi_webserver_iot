<!-- chapter03/templates/index_ws_client.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Flask Web Socket Example V2</title>
    <script src="/static/jquery.min.js"></script>
    <!-- <script src="/static/socket.io.js"></script>                            (1) -->
    <script type="text/javascript">

        // var socket = io();  // For API documentation see https://socket.io    // (2)

        var ws = new WebSocket('ws://localhost:8000/led');
        
        ws.onmessage = function(event) {
            var messages = document.getElementById('messages')
            var message = document.createElement('li')
            // var content = document.createTextNode(event.data)
            // message.appendChild(content)
            // messages.appendChild(message)

            dataFromServer = JSON.parse(event.data)
            console.log(dataFromServer)
            if (dataFromServer.level !== undefined) {
                $("input[type=range].brightnessLevel").val(dataFromServer.level);
                $("#brightnessLevel").html(dataFromServer.level);
            }
        };
        function sendMessage(dataFromServer) {
            var input = document.getElementById("messageText")
            ws.send(JSON.stringify(dataFromServer))
            input.value = ''
            event.preventDefault()
        }

        ws.onopen = function (event) {
            console.log("Connected to Server");
            $("#connected").html("Yes");
        };
        // socket.on('connect', function() {                                     // (3)
        //     console.log("Connected to Server");
        //     $("#connected").html("Yes");
        // });

        // socket.on('disconnect', function() {                                  // (4)
        //     console.log("Disconnected from the Server");
        //     $("#connected").html("No");
        // });

        // socket.on('led', function(dataFromServer) {                           // (5)
        //     console.log(dataFromServer)
        //     if (dataFromServer.level !== undefined) {
        //         $("input[type=range].brightnessLevel").val(dataFromServer.level);
        //         $("#brightnessLevel").html(dataFromServer.level);
        //     }
        // });

        $(document).ready(function() {                                        // (6)
            // Event listener for Slider value changes.
            $("input[type=range].brightnessLevel").on('input', function(){
                level = $(this).val();
                payload = {"level": level};
                // socket.emit('led', payload);
                sendMessage(payload)
            });
        });
    </script>
</head>
<body>
    <h1>Flask Web Socket Example</h1>
    LED is connected to GPIO {{pin}}<br>
    Connected to server: <span id="connected">No</span>                     <!-- (7) -->
    <br><br>
    Brightness <span id="brightnessLevel"></span>:<br>
    <input type="range" min="0" max="100" value="0" class="brightnessLevel">
</body>
</html> 